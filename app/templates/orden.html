{% extends "base.html" %}

{% block app_content %}
    <div class='jumbotron'>
        <div class="row">
            <div class="col-md-5">
                <strong style="font-size: 2em;"> Orden #{{orden.order_number}} </strong> <br>
                <strong> Cliente </strong>{{customer.name}}  <br>
                                          {{customer.email}} <br>
            </div>
            <div class="col-md-7">
                <strong style="font-size: 2em;">  </strong> <br>
                <strong>Estado:</strong> {{orden.status_resumen}} <br>
                <strong>Fecha de creación:</strong> {{ moment(orden.date_creation).format("DD/MM/YYYY")}} <br>
                <strong>Método de Envío:</strong> {{orden.courier_method}} <br>
                <strong>Guia:</strong> {{ orden.courier_order_id }}
                {% if orden.status_resumen == 'Solicitado' %}
                <br><strong> Costo del Envío: {{orden.courier_precio}}</strong>
                {% endif %}
            </div>
        </div>
    </div>
    <div class='container'>
        <table style="width:100%">
            <tr>
                <th>Linea</th>
                <th>Producto</th>
                <th>Código Producto</th>
                <th>Accion</th>
                <th>Cantidad</th>
                <th>Motivo</th>
                <th>Gestion</th>
                <th></th>
            </tr>
            {% for i in orden_linea %}
            <tr>
                <td>{{i['line_number']}}</td> 
                <td>{{i['name']}}</td> 
                <td>{{i['prod_id']}}</td> 
                <td>{{i['accion']}}</td>
                <td>{{i['accion_cantidad']}}</td>
                <td>{{i['motivo']}}</td>
                <td>{{i['gestionado']}}</td>
                

                {% if (orden.status == 'En Proceso' and orden.sub_status != 'Rechazado' and i['gestionado'] != 'Si') %}
                    <td><a href="{{ url_for('main.gestionar_producto', orden_id=orden.id, linea_id=i['order_line_number'] ) }}">
                        <button class="btn btn-primary"> Accion </button></td>
                {% endif %}
                {% if i['gestionado'] == 'Si' %}
                        <td><i class="fa fa-check-square-o" aria-hidden="true"></i></td>
                {% endif %}

                <td> <td><a href="{{ url_for('main.historia_producto', linea_id=i['order_line_number']) }}">
                    <button class="btn btn-link"> Ver Historia </button></td></td>

            </tr>
            {% endfor %}
        </table>
        <br><br>
        {% if orden.status == 'Shipping' %}
            {% if orden.sub_status == 'Solicitado' %}
                <a href="{{ url_for('main.gestionar_ordenes', orden_id = orden.id, accion_orden = 'toReady' ) }}">
                    <button class="btn btn-primary" title='Pasa el pedido a LISTO PARA RETIRO' > Confirmar </button></a> 
            {% endif %}
            {% if orden.sub_status == 'Recibido' %}
                <a href="{{ url_for('main.gestionar_ordenes', orden_id = orden.id, accion_orden = 'toApproved' ) }}">
                    <button class="btn btn-primary"> Revisada y Aprobada <i class="fa fa-check" aria-hidden="true"></i> </button></a>
            
                <a href="{{ url_for('main.gestionar_ordenes', orden_id = orden.id, accion_orden = 'toReject' ) }}">
                <button class="btn btn-danger"> Rechazada <i class="fa fa-times" aria-hidden="true"></i></button></a>
            {% endif %}
        {% endif %}    
        
        
    </div>
{% endblock %}